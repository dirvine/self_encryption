release:
  name: Release
  runs-on: ubuntu-latest
  needs: [macos, windows, linux, sdist]
  permissions:
    id-token: write
    contents: read
  steps:
    - uses: actions/download-artifact@v3
      with:
        path: dist
    - name: Move files to dist directory
      run: |
        mkdir -p dist_flat
        find dist -type f -exec mv {} dist_flat/ \;
        rm -rf dist
        mv dist_flat dist
    - name: Display structure of downloaded files
      run: ls -R dist
    - name: Publish to PyPI
      uses: pypa/gh-action-pypi-publish@release/v1
      with:
        packages-dir: dist/
        verbose: true
        print-hash: true 